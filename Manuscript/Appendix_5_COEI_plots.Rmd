---
output: 
  pdf_document:
fontsize: 12pt
geometry: margin=1in
number_sections: true
documentclass: article
csl: ecology.csl
---

```{r load_coei, echo=FALSE, message=FALSE, warning=FALSE}
source("../R/utils.R")

toLoad <- c("dplyr", "ggplot2", "lubridate")
instant_pkgs(toLoad); rm(toLoad)

## load plotting function
source("../R/full_effect_plot.R")

## Get covariate means and SDs
source("../R/create_new_data.R")

## Load sea duck data and relevant models
source("../R/load_sea_duck_data.R")
load("../Results_coei/zero.rda")
COEIocc <- zero

load("../Results_coei/hurdle.Rda")
COEIcc <- hurdle

## Set some graphic parameters
theme_set(theme_bw(base_size = 18))
theme_update(panel.grid.minor = element_blank(),
  panel.grid.major= element_blank(),
  panel.border=element_rect(fill=NA),
  panel.background= element_blank(),
  legend.position = 'none')

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE,
                      fig.width = 6.5, fig.height=6.5)
```

# Appendix 5. Common Eider stable covariate effects

Marginal functional plots of the relationships between covariates (controlling for all other variables; i.e., at their mean values) and the occupancy, conditional mean abundance, and conditional overdispersion of abundance of Common Eider in Nantucket Sound, Massachusetts, USA.  Covariate plots are ordered roughly in descending order of the magnitude of their influence on the additive predictor in each model (or model parameter for count models).  Vertical lines along the *x*-axis (i.e., rug plots) indicate observed covariate values.  Covariates (and any abbreviations) are defined in detail in Appendix 2; only effects selected to be stable (see Appendix 1) are depicted.

\newpage

## Occupancy

```{r occ_coei, out.extra=sprintf('angle=%d', c(90, rep(0, 8)))}
# xkm, ykm
full_effect_plot(COEIocc, coei, var = "xkm, ykm", varType = "st", xlab = "Easting (km from center)",
                 ylab = "Northing (km from center")
cat('\r\n\r\n')
  
vars <- c("SSTm", "meanphi", "obs_window", "cdom", "SAR", "d2land", "SBT", "y2005")
xlabs <- c(expression(paste(SST, ", ", monthly~average~(degree*C))),
           "Sediment grain size (phi)", expression(Survey~effort~(transect~km^2)), 
           "Chromomorphic dissolved organic matter",
           "Sea floor surface area:planimetric area", "Distance to land (km)",
           expression(paste(SBT, ", ", May~-~Oct~(degree*C))), "Winter (2005)")
types <- c(rep("uni", 7), "fac")

for (i in 1:length(vars)) {
  var <- vars[i]
  xlab <- xlabs[i]
  type <- types[i]
  print(full_effect_plot(COEIocc, coei, var, type, xlab = xlab))
  cat('\r\n\r\n')
}
```

## Conditional mean
```{r mu_coei}
vars <- c("cdom", "SSTrel", "meanphi", "SAR", "depth", "ferry")
xlabs <- c("Chromomorphic dissolved organic matter", 
            expression(paste(SST, ", ", relative~to~other~segments~(degree*C))),
            "Sediment grain size (phi)", "Sea floor surface area:planimetric area", 
            "Depth relative to mean sea level (m)","Ferry route within 1 km")
types <- c(rep("uni", 5), "fac")
for (i in 1:length(vars)) {
  var <- vars[i]
  xlab <- xlabs[i]
  type <- types[i]
  print(full_effect_plot(COEIcc, parameter = "mu", var = var, varType = type, xlab = xlab))
  cat('\r\n\r\n')
}
```

## Conditional overdispersion
```{r sigma_coei, out.extra=sprintf('angle=%d', c(90, rep(0, 5)))}
full_effect_plot(COEIcc, parameter="sigma", var = "xkm, ykm", varType="bi", 
                 xlab = "Easting (km from center)",
                 ylab = "Northing (km from center)")
cat('\r\n\r\n')

vars <- c("tidebmean", "depth", "tidesd", "SSTm", "y2004")
xlabs <- c("Epibenthic tidal velocity (mean; m/s)", "Depth relative to mean sea level (m)",
            "Epibenthic tidal velocity (standard deviation; m/s)", 
            expression(paste(SST, ", ", monthly~average~(degree*C))), 
            "Winter (2004)")
types <- c(rep("uni", 4), "fac")
for (i in 1:length(vars)) {
  var <- vars[i]
  xlab <- xlabs[i]
  type <- types[i]
  print(full_effect_plot(COEIcc, parameter = "sigma", var = var, varType = type, xlab = xlab))
  cat('\r\n\r\n')
}
```
