---
output: 
  pdf_document:
fontsize: 12pt
geometry: margin=1in
number_sections: true
documentclass: article
csl: ecology.csl
---

```{r load_ltdu, echo=FALSE, message=FALSE, warning=FALSE}
source("../R/utils.R")

toLoad <- c("dplyr", "ggplot2", "lubridate")
instant_pkgs(toLoad); rm(toLoad)

## load plotting function
source("../R/full_effect_plot.R")

## Get covariate means and SDs
source("../R/create_new_data.R")

## Load sea duck data and relevant models
source("../R/load_sea_duck_data.R")
load("../Results_ltdu/zero.Rda")
LTDUocc <- zero

load("../Results_ltdu/hurdle.Rda")
LTDUcc <- hurdle

## Set some graphic parameters
theme_set(theme_bw(base_size = 18))
theme_update(panel.grid.minor = element_blank(),
  panel.grid.major= element_blank(),
  panel.border=element_rect(fill=NA),
  panel.background= element_blank(),
  legend.position = 'none')

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE,
                      fig.height=6.5, fig.width=6.5)
```

# Appendix 7. Long-tailed Duck stable covariate effects

Marginal functional plots of the relationships between covariates (controlling for all other variables; i.e., at their mean values) and the occupancy, conditional mean abundance, and conditional overdispersion of abundance of Long-tailed Duck in Nantucket Sound, Massachusetts, USA.  Covariate plots are ordered roughly in descending order of the magnitude of their influence on the additive predictor in each model (or model parameter for count models). Vertical lines along the *x*-axis (i.e., rug plots) indicate observed covariate values.  Covariates (and any abbreviations) are defined in detail in Appendix 2; only effects selected to be stable (see Appendix 1) are depicted.

\newpage

## Occupancy
```{r occ_ltdu, out.extra=sprintf('angle=%d', c(90,0,0,0,0,90,0,0,0))}
# xkm, ykm
full_effect_plot(LTDUocc, ltdu, var = "xkm, ykm", varType = "st", xlab = "Easting (km from center)",
                 ylab = "Northing (km from center")
cat('\r\n\r\n')

vars <- c("SSTm", "time", "obs_window", "meanphi")
xlabs <- c(expression(paste(SST, ", ", monthly~average~(degree*C))),
          "Days from 31 December", expression(Survey~effort~(transect~km^2)),
          "Sediment grain size (phi)")
types <- rep("uni", 4)

for (i in 1:length(vars)) {
  var <- vars[i]
  xlab <- xlabs[i]
  type <- types[i]
  print(full_effect_plot(LTDUocc, ltdu, var, type, xlab = xlab))
  cat('\r\n\r\n')
}

full_effect_plot(LTDUocc, ltdu, var = "time, depth", varType = "bi",
                 xlab = "Days from 31 December", 
                 ylab = "Depth relative to mean sea level (m)")
cat('\r\n\r\n')

vars <- c("d2land", "tidesd", "y2004")
xlabs <- c("Distance to land (km)",
          "Epibenthic tidal velocity (standard deviation; m/s)",
          "Winter (2004)")
types <- c("uni", "uni", "fac")

for (i in 1:length(vars)) {
  var <- vars[i]
  xlab <- xlabs[i]
  type <- types[i]
  print(full_effect_plot(LTDUocc, ltdu, var, type, xlab = xlab))
  cat('\r\n\r\n')
}
```

## Conditional mean
```{r mu_ltdu, out.extra=sprintf('angle=%d', c(90,90,0))}
# xkm, ykm
full_effect_plot(LTDUcc, parameter = "mu", var = "xkm, ykm", varType = "st", 
                 xlab = "Easting (km from center)", ylab = "Northing (km from center")
cat('\r\n\r\n')

full_effect_plot(LTDUcc, parameter = "mu", var = "time, depth", varType = "bi", 
                 xlab = "Days from 31 December", 
                 ylab = "Depth relative to mean sea level (m)")
cat('\r\n\r\n')

full_effect_plot(LTDUcc, parameter = "mu", var = "SSTm", 
                 xlab = expression(paste(SST, ", ", monthly~average~(degree*C))))
cat('\r\n\r\n')
```

## Conditional overdispersion
```{r sigma_ltdu}
full_effect_plot(LTDUcc, parameter = "sigma", var = "strat", 
                 xlab = "Water column stratification potential (summer)")
cat('\r\n\r\n')
```
